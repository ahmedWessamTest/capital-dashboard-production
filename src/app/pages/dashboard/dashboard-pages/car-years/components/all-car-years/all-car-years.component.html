<p-toast></p-toast>

@if (combinedData.length > 0) {
<div class="card">
  <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center mb-3 gap-2">
    <h2 class="text-xl md:text-2xl font-semibold m-0">Car Years Control</h2>
    <p-button 
      routerLink="/dashboard/menu/car-years/add" 
      label="Add Car Year" 
      icon="pi pi-plus" 
      class="btn-main text-white w-full md:w-auto">
    </p-button>
  </div>

  <div class="mb-3 flex justify-content-end">
    <span class="p-input-icon-right w-full md:w-auto">
      <i class="pi pi-search"></i>
      <input 
        #search 
        class="mb-0 w-full" 
        type="text" 
        pInputText 
        placeholder="Search car years..." 
        (input)="onGlobalFilter($event)" />
    </span>
  </div>

  <div class="overflow-x-auto">
    <p-table 
      #dt 
      [paginator]="true" 
      [rows]="rowsPerPage" 
      [totalRecords]="totalRecords" 
      [rowsPerPageOptions]="getPagination()" 
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [value]="filteredData" 
      responsiveLayout="scroll"
      styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines"
      [scrollable]="true"
      scrollDirection="both"
      (onPage)="onPageChange($event)"
      >
      
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="id" class="text-center" style="min-width: 80px">
            ID <p-sortIcon field="id"></p-sortIcon>
          </th>
          
          <!-- Year Filter -->
          <th class="text-center" style="min-width: 120px">
            <p-dropdown 
              [options]="yearOptions" 
              optionLabel="label" 
              optionValue="value"
              [(ngModel)]="activeFilters['year']" 
              (onChange)="onFilterChange('year', $event.value)"
              placeholder="Year" 
              [showClear]="true" 
              [autoZIndex]="true"
              appendTo="body"
              [dropdownIcon]="'pi pi-filter'">
            </p-dropdown>
          </th>
          
          <!-- Model Filter -->
          <th class="text-center" style="min-width: 150px">
            <p-dropdown 
              [options]="modelOptions" 
              optionLabel="label" 
              optionValue="value"
              [(ngModel)]="activeFilters['model']" 
              (onChange)="onFilterChange('model', $event.value)"
              placeholder="Model" 
              [showClear]="true" 
              [autoZIndex]="true"
              appendTo="body"
              [dropdownIcon]="'pi pi-filter'">
            </p-dropdown>
          </th>
          
          <!-- Brand Filter -->
          <th class="text-center" style="min-width: 150px">
            <p-dropdown 
              [options]="brandOptions" 
              optionLabel="label" 
              optionValue="value"
              [(ngModel)]="activeFilters['brand']" 
              (onChange)="onFilterChange('brand', $event.value)"
              placeholder="Brand" 
              [showClear]="true" 
              [autoZIndex]="true"
              appendTo="body"
              [dropdownIcon]="'pi pi-filter'">
            </p-dropdown>
          </th>
          
          <!-- Type Filter -->
          <th class="text-center" style="min-width: 150px">
            <p-dropdown 
              [options]="typeOptions" 
              optionLabel="label" 
              optionValue="value"
              [(ngModel)]="activeFilters['type']" 
              (onChange)="onFilterChange('type', $event.value)"
              placeholder="Type" 
              [showClear]="true" 
              [autoZIndex]="true"
              appendTo="body"
              [dropdownIcon]="'pi pi-filter'">
            </p-dropdown>
          </th>
          
          <!-- Status Filter -->
          <th class="text-center" style="min-width: 150px">
            <p-dropdown 
              [options]="statusOptions" 
              optionLabel="label" 
              optionValue="value"
              [(ngModel)]="activeFilters['status']" 
              (onChange)="onFilterChange('status', $event.value)"
              placeholder="Status" 
              [showClear]="true" 
              [autoZIndex]="true"
              appendTo="body"
              [dropdownIcon]="'pi pi-filter'">
            </p-dropdown>
          </th>
          
          <th class="text-center" style="min-width: 100px">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-item>
        <tr>
          <td class="text-center">{{ item.id }}</td>
          <td class="text-center">{{ item.year_date }}</td>
          <td class="text-center">{{ item.car_model_title }}</td>
          <td class="text-center">{{ item.car_brand_title }}</td>
          <td class="text-center">{{ item.car_type_title }}</td>
          <td class="text-center">
            <p-inputSwitch 
              [ngModel]="normalizeActiveStatus.normalizeActiveStatus(item.active_status)"
              (onChange)="toggleStatus(item)">
            </p-inputSwitch>
          </td>
          <td class="text-center">
            <p-button 
              icon="pi pi-pencil" 
              [routerLink]="['/dashboard/menu/car-years/edit', item.id]" 
              class="p-button-text p-button-sm">
            </p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <app-no-data-found-banner></app-no-data-found-banner>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
} @else {
<app-loading-data-banner></app-loading-data-banner>
}