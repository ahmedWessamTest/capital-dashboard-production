@if (isLoading) {
  <app-loading-data-banner></app-loading-data-banner>
} @else {
  <div class="card">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-2xl font-semibold">{{title}}</h2>
      @if (addBtnTitle) {
        <p-button
          [routerLink]="title === 'Products Control' ? '/dashboard/menu/products/products-add' : '/dashboard/menu/products/choices/add'"
          [label]="addBtnTitle"
          icon="pi pi-plus"
          class="btn-main text-white"></p-button>
      }
    </div>

    <!-- Search Input -->
    <div class="mb-3 flex justify-content-end">
      <span class="p-input-icon-right">
        <i class="pi pi-search"></i>
        <input
          class="mb-0"
          type="text"
          pInputText
          [placeholder]="'Search ' + title.toLowerCase() + '...'"
          (input)="onGlobalFilter($event)" />
      </span>
    </div>

    <p-table
      #dt
      [paginator]="true"
      [rows]="rowsPerPage"
      [totalRecords]="totalRecords"
      [rowsPerPageOptions]="getPagination()"
      [showCurrentPageReport]="true"
      [value]="filteredData"
      responsiveLayout="scroll"
      (onSort)="onSort($event)">
      <ng-template pTemplate="header">
        <tr>
          @for (header of displayHeaders; track header; let i = $index) {
            <th class="text-center" [pSortableColumn]="columnKeys[i]">
              @if (columnKeys[i] === 'category') {
                <p-dropdown
                  class="mx-auto"
                  styleClass="mx-auto"
                  [options]="categoryData"
                  optionLabel="label"
                  optionValue="value"
                  (onChange)="categoryFilterChanged.emit($event.value)"
                  placeholder="Category (EN)"
                  [showClear]="true"
                  [autoZIndex]="true"></p-dropdown>
              } @else if (columnKeys[i] === 'active_status' && selectOptions.length > 0) {
                <p-dropdown
                  class="mx-auto"
                  styleClass="mx-auto"
                  [options]="selectOptions"
                  optionLabel="label"
                  optionValue="value"
                  (onChange)="statusFilterChanged.emit($event.value)"
                  placeholder="Status"
                  [showClear]="true"
                  [autoZIndex]="true"></p-dropdown>
              } @else {
                {{ header }}
                <p-sortIcon [field]="columnKeys[i]"></p-sortIcon>
              }
            </th>
          }
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-item>
        <tr>
          @for (key of columnKeys; track key) {
            <td class="text-center">
              @if (key === 'id') {
                {{ item.id }}
              } @else if (key === 'en_name') {
                {{ item.en_name | titlecase }}
              } @else if (key === 'ar_name') {
                {{ item.ar_name }}
              } @else if (key === 'cuurent_value') {
                {{ item.cuurent_value }}
              } @else if (key === 'active_status') {
                {{ getStatusText(item.active_status) }}
                <p-inputSwitch
                  [ngModel]="isStatusActive(item.active_status)"
                  (onChange)="toggleStatus(item)"
                  class="ml-2"></p-inputSwitch>
              } @else if (key === 'category') {
                {{ item.category?.en_name || 'N/A' }}
              } @else if (key === 'actions') {
                <p-button
                  icon="pi pi-pencil"
                  [routerLink]="['/dashboard/menu/products/products-edit', item.id]"
                  class="p-button-text"></p-button>
              } @else if (key === 'prices') {
                <p-button
                  icon="pi pi-dollar"
                  [routerLink]="['/dashboard/menu/products/products-pice-price', item.id]"
                  class="p-button-text"></p-button>
              } @else if (key === 'choices') {
                @if (item.choices?.length > 0) {
                  <p-button
                    icon="pi pi-list"
                    [routerLink]="['/dashboard/menu/products/products-choice', item.id]"
                    class="p-button-text"></p-button>
                }
              } @else if (key === 'view') {
                <button
                  [routerLink]="['/dashboard/menu/products/products-details', item.id]"
                  pButton
                  label="View"
                  icon="pi pi-search"></button>
              } @else {
                {{ item[key] || 'N/A' }}
              }
            </td>
          }
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="displayHeaders.length">
            <div class="h-48 flex justify-center items-center flex-col">
              <app-no-data-found-banner></app-no-data-found-banner>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
}